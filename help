#!/bin/bash
# Standalone help — works even if w is completely broken
KIT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

bold=$(tput bold)
reset=$(tput sgr0)
dim=$(tput dim)
green=$(tput setaf 2)
blue=$(tput setaf 4)
red=$(tput setaf 1)
yellow=$(tput setaf 3)

cat <<HELPTEXT
${bold}=== WATCH ===${reset}

  ${bold}w${reset}                  Watch tests, auto-refresh on save
  ${green}-s, --stop${reset}         Stop on first failure
  ${green}-f, --failed${reset}       Only re-run tests that failed last time
  ${green}-n, --no-refresh${reset}   Disable auto-refresh
  ${green}-t, --test-dir DIR${reset} Override test directory
  ${green}-T, --timeout SEC${reset}  Per-test timeout in seconds (default 2)

  Keys: ${green}d${reset} PUDB  ${green}p${reset} PDB++  ${green}q${reset} Quit

───────────────────────────────────────────────────

${bold}=== BREAKPOINTS ===${reset}

  ${bold}bp add FILE LINE${reset}   Add breakpoint        ${bold}bp list${reset}    List all
  ${bold}bp rm FILE LINE${reset}    Remove breakpoint     ${bold}bp clear${reset}   Clear all

───────────────────────────────────────────────────

${bold}=== SKIP TESTS ===${reset}

  ${bold}skip add TEST${reset}      Skip a test           ${bold}skip list${reset}  List all
  ${bold}skip rm TEST${reset}       Unskip a test         ${bold}skip clear${reset} Clear all

───────────────────────────────────────────────────

${bold}=== TRACE ===${reset}

  ${dim}@traceit_ available everywhere (no import needed)${reset}
  ${bold}untrace${reset}              Remove all @traceit_ decorators (recursive from .)
  ${bold}untrace FILE${reset}         Remove from specific file
  ${bold}untrace DIR${reset}          Remove from all .py files in directory

───────────────────────────────────────────────────

${bold}=== IF W IS BROKEN ===${reset}

    ${bold}dbg tests/foo.py${reset}                  ${dim}# run all tests${reset}
    ${bold}dbg tests/foo.py test_bar${reset}         ${dim}# debug with pudb${reset}
    ${bold}dbg tests/foo.py test_bar pdbpp${reset}   ${dim}# debug with pdb++${reset}

  ${dim}Nuclear: add${reset} ${bold}import pudb; pudb.set_trace()${reset} ${dim}in your test, then:${reset}
    ${bold}python3 -m unittest tests/foo.py -k test_method${reset}

${bold}DIAGNOSIS${reset}
  ${dim}Syntax error?${reset}     python3 -m py_compile your_file.py
  ${dim}Import crash?${reset}     python3 -c "import your_module"
  ${dim}Wrong tests?${reset}      Check header: [CUSTOM TESTS] vs [OFFICIAL TESTS]
                    Uses ${blue}custom_tests/${reset} if exists, else ${blue}tests/${reset}
HELPTEXT
