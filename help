#!/bin/bash
# Standalone help — works even if w is completely broken
KIT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

bold=$(tput bold)
reset=$(tput sgr0)
dim=$(tput dim)
green=$(tput setaf 2)
blue=$(tput setaf 4)
red=$(tput setaf 1)
yellow=$(tput setaf 3)

cat <<HELPTEXT
${bold}=== PRETTY TESTING — EMERGENCY REFERENCE ===${reset}

${bold}${green}LEVEL 0: w is working${reset}
  Just use it. Keys:
    ${green}d${reset}  debug first failure with pudb
    ${green}p${reset}  debug first failure with pdb++
  Options:
    ${bold}w${reset}       ${dim}# run all tests (default)${reset}
    ${bold}w -s${reset}    ${dim}# stop on first failure${reset}
  Tests come from ${blue}custom_tests/${reset} if it exists, otherwise ${blue}tests/${reset}.

${bold}${yellow}LEVEL 1: w is broken, but Python works${reset}
  Use ${blue}dbg${reset} — one command does everything:
    ${bold}dbg tests/foo.py${reset}                  ${dim}# run all tests in file${reset}
    ${bold}dbg tests/foo.py test_bar${reset}         ${dim}# debug specific test (pudb)${reset}
    ${bold}dbg tests/foo.py test_bar pdbpp${reset}   ${dim}# debug with pdb++${reset}
    ${bold}dbg custom_tests/foo.py${reset}           ${dim}# custom test dir${reset}

${bold}${red}LEVEL 2: dbg is broken, do it by hand${reset}
  Two steps:
    ${bold}python3 ${KIT_ROOT}/test_generator.py tests/foo.py test_bar${reset}
    ${bold}python3 custom/debug_this_test.py${reset}
  This runs the test with tracing. To debug, add one line before running:
    ${bold}python3 ${KIT_ROOT}/debug_prep.py debug custom/debug_this_test.py --method test_bar${reset}
    ${bold}python3 custom/debug_this_test.py${reset}

${bold}${red}LEVEL 3: nothing works, nuclear fallback${reset}
  1. Open your test file
  2. Add this line right inside the test method:
       ${bold}import pudb; pudb.set_trace()${reset}    ${dim}# or: import pdb; pdb.set_trace()${reset}
  3. Run it (test files have no main block, so you must use unittest):
       ${bold}python3 -m unittest tests/foo.py -k test_method_name${reset}
     or if that fails:
       ${bold}python3 -c "import unittest; unittest.main(module=None, argv=['', 'discover', '-s', 'tests', '-k', 'test_method'])"${reset}
     or with pytest if installed:
       ${bold}python3 -m pytest tests/foo.py::TestClass::test_bar -s${reset}

${bold}QUICK DIAGNOSIS${reset}
  ${dim}Syntax error?${reset}       python3 -m py_compile your_file.py
  ${dim}Import crashing?${reset}    python3 -c "import your_module"
  ${dim}setUp crashing?${reset}     python3 ${KIT_ROOT}/debug_prep.py debug custom/debug_this_test.py \\
                        --method test_bar ${dim}# auto-detects and injects into setUp${reset}
  ${dim}Wrong tests?${reset}        Check header in w: [CUSTOM TESTS] vs [OFFICIAL TESTS]
                      w uses ${blue}custom_tests/${reset} if it exists, else ${blue}tests/${reset}
HELPTEXT
